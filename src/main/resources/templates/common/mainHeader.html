<header th:fragment="header" xmlns:th="http://www.thymeleaf.org">
    <meta charset="UTF-8">

    <div id="header-id" class="w-full h-[380px] box-border"
         style="background-image: url('/images/헤더 영역 이미지.png'); background-size: cover; background-position: center;">
        <div id="header-wrapper"
             class="w-full h-[100px] hover:bg-white flex items-start justify-between text-center">

            <div class="w-[240px] h-[100px] flex justify-start items-center">
                <a href="../home/main" class="h-full flex items-center">
                    <img src="/images/로고.png"
                         class="object-contain cursor-pointer"/>
                </a>
            </div>

            <nav class="w-[60%] text-center">
                <ul id="nav-list" class="flex justify-center items-center relative space-x-4">
                    <!-- 상권 분석 -->
                    <li class="relative group w-[240px]">
                        <a href="../map/commercialZoneMap"
                           class="flex justify-center items-center w-full h-[100px] cursor-pointer">
                            <p class="text-[22px] text-black">상권 분석</p>
                        </a>
                        <ul class="sub-menu absolute items-center top-full left-1/2 transform -translate-x-1/2 hidden bg-white w-full z-10 text-center">
                            <li class="w-full">
                                <a href="../map/correlationMap"
                                   class="block px-4 py-2 hover:underline">위험도 분석</a>
                            </li>
                        </ul>
                    </li>

                    <!-- 부동산 매물 -->
                    <li class="flex justify-center items-center w-[240px] h-[100px] relative">
                        <p class="text-[22px] text-black">부동산 매물</p>
                    </li>

                    <!-- 상가 청약 -->
                    <li class="relative group w-[240px]">
                        <div class="flex justify-center items-center w-full h-[100px] cursor-pointer">
                            <p class="text-[22px] text-black">상가 청약</p>
                        </div>
                        <ul class="sub-menu absolute flex-col items-center top-full left-1/2 transform -translate-x-1/2 hidden bg-white w-full z-10 text-center">
                            <li><a href="#" class="block px-4 py-2 hover:underline">청약 알림</a></li>
                            <li><a href="#" class="block px-4 py-2 hover:underline">공고문</a></li>
                            <li><a href="../member/conditionalLogout" class="block px-4 py-2 hover:underline">로그아웃</a>
                            </li>
                        </ul>
                    </li>

                    <!-- 로그인 -->
                    <li>
                        <a href="../member/joinAndLogin"
                           class="flex justify-center items-center w-[240px] h-[100px] relative cursor-pointer">
                            <p class="text-[22px] text-black">로그인</p>
                        </a>
                    </li>

                    <!-- 알림 아이콘 + 팝업 -->
                    <li id="notif-wrapper" class="relative">
                        <!-- 알림벨 버튼 -->
                        <button id="notif-icon" type="button" class="cursor-pointer select-none">
                            <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24">
                                <g fill="none" stroke="#9990e1" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                                    <path stroke-dasharray="4" stroke-dashoffset="4" d="M12 3v2">
                                        <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="4;0"/>
                                    </path>
                                    <path fill="#9990e1" fill-opacity="0" stroke-dasharray="28" stroke-dashoffset="28"
                                          d="M12 5c-3.31 0 -6 2.69 -6 6l0 6c-1 0 -2 1 -2 2h8M12 5c3.31 0 6 2.69 6 6l0 6c1 0 2 1 2 2h-8">
                                        <animate fill="freeze" attributeName="fill-opacity" begin="0.9s" dur="0.5s" values="0;1"/>
                                        <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.2s" dur="0.4s" values="28;0"/>
                                    </path>
                                    <path stroke-dasharray="8" stroke-dashoffset="8"
                                          d="M10 20c0 1.1 0.9 2 2 2c1.1 0 2 -0.9 2 -2">
                                        <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="8;0"/>
                                    </path>
                                </g>
                            </svg>
                        </button>

                        <!-- 팝업 알림함 불러오기 -->
                        <div th:replace="common/subscription :: subscription"></div>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="w-full flex justify-center items-center gap-16 mt-[100px]">
            <!-- 첫 번째 아이콘 -->
            <div class="w-[100px] h-[100px] rounded-[10px] bg-white flex items-center justify-center">
                <a href="../map/correlationMap">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 24 24">
                        <path fill="#E94876" fill-rule="evenodd"
                              d="M14 20.5V4.25c0-.728-.002-1.2-.048-1.546c-.044-.325-.115-.427-.172-.484s-.159-.128-.484-.172C12.949 2.002 12.478 2 11.75 2s-1.2.002-1.546.048c-.325.044-.427.115-.484.172s-.128.159-.172.484c-.046.347-.048.818-.048 1.546V20.5z"
                              clip-rule="evenodd"/>
                        <path fill="#E94876"
                              d="M8 8.75A.75.75 0 0 0 7.25 8h-3a.75.75 0 0 0-.75.75V20.5H8zm12 5a.75.75 0 0 0-.75-.75h-3a.75.75 0 0 0-.75.75v6.75H20z"
                              opacity="0.7"/>
                        <path fill="#E94876" d="M1.75 20.5a.75.75 0 0 0 0 1.5h20a.75.75 0 0 0 0-1.5z" opacity="0.5"/>
                    </svg>
                </a>
            </div>

            <!-- 두 번째 아이콘 -->
            <div class="w-[100px] h-[100px] rounded-[10px] bg-white flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 24 24">
                    <g fill="#3D9ECC">
                        <path d="M9.883 2.207a1.9 1.9 0 0 1 2.087 1.522l.025.167L12 4v7a1 1 0 0 0 .883.993L13 12h6.8a2 2 0 0 1 2 2a1 1 0 0 1-.026.226A10 10 0 1 1 9.504 2.293l.27-.067z"/>
                        <path d="M14 3.5V9a1 1 0 0 0 1 1h5.5a1 1 0 0 0 .943-1.332a10 10 0 0 0-6.11-6.111A1 1 0 0 0 14 3.5"/>
                    </g>
                </svg>
            </div>

            <!-- 세 번째 아이콘 -->
            <div class="w-[100px] h-[100px] rounded-[10px] bg-white flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 640 640">
                    <g fill="#B197FC">
                        <path d="M128 64C92.7 64 64 92.7 64 128L64 512C64 547.3 92.7 576 128 576L308 576C297.5 561.4 289 545.3 282.9 528L208 528L208 448C208 430.3 222.3 416 240 416L272 416C274 416 276 416.2 277.9 416.5C283.9 392.9 294.2 371.1 308 352L304 352C295.2 352 288 344.8 288 336L288 304C288 295.2 295.2 288 304 288L336 288C344.8 288 352 295.2 352 304L352 308C379.5 288.2 412.3 275.6 448 272.6L448 128C448 92.7 419.3 64 384 64L128 64zM160 176C160 167.2 167.2 160 176 160L208 160C216.8 160 224 167.2 224 176L224 208C224 216.8 216.8 224 208 224L176 224C167.2 224 160 216.8 160 208L160 176zM304 160L336 160C344.8 160 352 167.2 352 176L352 208C352 216.8 344.8 224 336 224L304 224C295.2 224 288 216.8 288 208L288 176C288 167.2 295.2 160 304 160zM160 304C160 295.2 167.2 288 176 288L208 288C216.8 288 224 295.2 224 304L224 336C224 344.8 216.8 352 208 352L176 352C167.2 352 160 344.8 160 336L160 304zM608 464C608 384.5 543.5 320 464 320C384.5 320 320 384.5 320 464C320 543.5 384.5 608 464 608C543.5 608 608 543.5 608 464zM521.4 403.1C528.5 408.3 530.1 418.3 524.9 425.4L460.9 513.4C458.1 517.2 453.9 519.6 449.2 519.9C444.5 520.2 439.9 518.6 436.6 515.3L396.6 475.3C390.4 469.1 390.4 458.9 396.6 452.7C402.8 446.5 413 446.5 419.2 452.7L446 479.5L499 406.6C504.2 399.5 514.2 397.9 521.4 403.1z"/>
                    </g>
                </svg>
            </div>

            <!-- 네 번째 아이콘 -->
            <div class="w-[100px] h-[100px] rounded-[10px] bg-white flex items-center justify-center">
                <!-- 아이콘 고민 -->
            </div>

            <!-- 다섯 번째 아이콘 -->
            <div class="w-[100px] h-[100px] rounded-[10px] bg-white flex items-center justify-center">
                <a href="../home/notifications" class="cursor-pointer">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 24 24">
                        <g fill="none" stroke="#9990e1" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
                            <path d="M12 3v2"/>
                            <path fill="#9990e1"
                                  d="M12 5c-3.31 0 -6 2.69 -6 6l0 6c-1 0 -2 1 -2 2h8M12 5c3.31 0 6 2.69 6 6l0 6c1 0 2 1 2 2h-8"/>
                            <path d="M10 20c0 1.1 0.9 2 2 2c1.1 0 2 -0.9 2 -2"/>
                        </g>
                    </svg>
                </a>
            </div>
        </div>
    </div>

    <script>
        const headerId = document.getElementById('header-id');
        const header = document.getElementById('header-wrapper');
        const navList = document.getElementById('nav-list');
        const subMenus = document.querySelectorAll('.sub-menu');

        let hoverTimeout;

        const expandHeader = () => {
            clearTimeout(hoverTimeout);
            headerId.classList.remove('h-[100px]');
            headerId.classList.add('h-[250px]');
            header.classList.remove('h-[100px]');
            header.classList.add('h-[250px]');
            subMenus.forEach(menu => {
                menu.classList.remove('hidden');
                menu.classList.add('flex');
            });
        };

        const collapseHeader = () => {
            hoverTimeout = setTimeout(() => {
                headerId.classList.remove('h-[250px]');
                headerId.classList.add('h-[100px]');
                header.classList.remove('h-[250px]');
                header.classList.add('h-[100px]');
                subMenus.forEach(menu => {
                    menu.classList.remove('flex');
                    menu.classList.add('hidden');
                });
            }, 100);
        };

        navList.addEventListener('mouseenter', expandHeader);
        navList.addEventListener('mouseleave', collapseHeader);

        // 알림 팝업 토글 + 외부 클릭 닫기
        const notifIcon = document.getElementById('notif-icon');
        const notifPopover = document.getElementById('notif-popover');
        const notifClose = document.getElementById('notif-close');
        const wrapper = document.getElementById('notif-wrapper');

        // 더보기 토글(팝업 내부)
        document.addEventListener('click', (e) => {
            if (e.target.closest('.more-btn')) {
                const btn = e.target.closest('.more-btn');
                const panel = btn.parentElement.querySelector('.more-panel');
                const icon = btn.querySelector('svg path');
                const hidden = panel.classList.contains('hidden');

                panel.classList.toggle('hidden');

                if (icon) icon.setAttribute('d', hidden ? 'M7 14l5-5 5 5z' : 'M7 10l5 5 5-5z');
            }
        });

        // 아이콘 클릭 → 팝업 열기/닫기
        notifIcon.addEventListener('click', (e) => {
            e.preventDefault();

            // 페이지 이동 방지
            notifPopover.classList.toggle('hidden');
        });

        // 닫기 버튼
        notifClose.addEventListener('click', () => notifPopover.classList.add('hidden'));

        // 바깥 클릭 시 닫기
        document.addEventListener('click', (e) => {
            if (!wrapper.contains(e.target)) notifPopover.classList.add('hidden');
        });
    </script>

</header>
