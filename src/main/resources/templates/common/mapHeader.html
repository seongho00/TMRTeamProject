<header th:fragment="header" xmlns:th="http://www.thymeleaf.org">
    <meta charset="UTF-8">

    <div class="w-full h-[80px] box-border align-top left-0 bg-white transition-all duration-300 z-50">
        <div class="w-full h-[80px] flex items-start justify-between transition-all duration-300 z-50">

            <div class="w-[240px] h-[80px] flex justify-start items-center">
                <a href="../home/main" class="flex items-center">
                    <!-- 파란색 로고 -->
                    <img src="/images/로고.png"
                         class="w-[160px] h-[60px] object-cover cursor-pointer"/>
                </a>
            </div>

            <nav class="w-[60%] h-[80px] flex text-center">
                <ul class="relative flex justify-center items-center">
                    <!-- 상권 분석 -->
                    <li class="relative flex justify-center items-center mx-[90px] h-[80px] group
                               after:content-[''] after:absolute after:left-1/2 after:right-1/2 after:bottom-0
                               after:border-b-0 after:border-b-[#EB0E2A] after:transition-all after:duration-200
                               hover:after:left-0 hover:after:right-0 hover:after:border-b-2">
                        <a class="inline-block w-auto flex-none leading-none subheading text-[16px] cursor-pointer">
                            상권 분석
                        </a>
                        <div class="fixed left-0 w-screen hidden top-[80px] h-[50px] bg-white border-t border-b border-[#ccc] group-hover:flex transition-all duration-200 z-50">
                            <ul class="flex items-center ml-[680px] mr-auto">
                                <li>
                                    <a href="../map/commercialZoneMap" class="inline-block text-[14px] px-2 transition-all duration-300 hover:text-black">유동인구/매출</a>
                                </li>
                                <li>
                                    <a href="../map/riskMap" class="inline-block text-[14px] px-2 transition-all duration-300 hover:text-black">위험도분석</a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <!-- 등기부등본 -->
                    <li class="relative group flex justify-center items-center mx-[90px] h-[80px]
                               after:content-[''] after:absolute after:left-1/2 after:right-1/2 after:bottom-0
                               after:border-b-0 after:border-b-[#EB0E2A] after:transition-all after:duration-200
                               hover:after:left-0 hover:after:right-0 hover:after:border-b-2">
                        <a href="../property/upload" class="inline-block w-auto flex-none leading-none subheading text-[16px] cursor-pointer">
                            등기부등본
                        </a>
                    </li>

                    <!-- 상가 청약 -->
                    <li class="relative flex justify-center items-center group/menu2 mx-[90px] h-[80px] after:content-['']
                               after:absolute after:left-1/2 after:right-1/2 after:bottom-0
                               after:border-b-0 after:border-b-[#EB0E2A] after:transition-all after:duration-200
                               hover:after:left-0 hover:after:right-0 hover:after:border-b-2">
                        <a class="inline-block w-auto flex-none leading-none subheading text-[16px] cursor-pointer">
                            상가 청약
                        </a>
                        <div class="fixed left-0 w-screen hidden top-[80px] h-[50px] bg-white border-t border-b border-[#ccc] group-hover/menu2:flex transition-all duration-200 z-50">
                            <ul class="flex items-center ml-[1160px] mr-auto">
                                <li>
                                    <a href="../home/notifications" class="inline-block text-[14px] px-2 transition-all duration-300 hover:text-black">청약 알림</a>
                                </li>
                                <li>
                                    <a href="../lh/notice" class="inline-block text-[14px] px-2 transition-all duration-300 hover:text-black">공고문</a>
                                </li>
                            </ul>
                        </div>
                    </li>

                    <!-- 로그인 -->
                    <li class="relative flex justify-center items-center w-[240px] h-[80px] group">
                        <ul>
                            <li th:if="${rq != null and rq.isLogout()}">
                                <a href="../member/joinAndLogin"
                                   class="relative inline-block w-auto flex-none leading-none subheading text-[16px] cursor-pointer
                                              after:content-[''] after:absolute after:left-1/2 after:right-1/2 after:bottom-[-32px]
                                              after:border-b-0 after:border-b-[#EB0E2A] after:transition-all after:duration-200
                                              hover:after:left-0 hover:after:right-0 hover:after:border-b-2">
                                    로그인
                                </a>
                            </li>
                            <li th:if="${rq != null and rq.isLogined()}">
                                <a href="../member/conditionalLogout"
                                   class="relative inline-block w-auto flex-none leading-none subheading text-[16px] cursor-pointer
                                              after:content-[''] after:absolute after:left-1/2 after:right-1/2 after:bottom-[-32px]
                                              after:border-b-0 after:border-b-[#EB0E2A] after:transition-all after:duration-200
                                              hover:after:left-0 hover:after:right-0 hover:after:border-b-2">
                                    로그아웃
                                </a>
                            </li>
                        </ul>
                    </li>

                    <!-- 알림 아이콘 + 팝업 -->
                    <li id="notif-wrapper" class="relative group" th:if="${rq != null and rq.isLogined()}">
                        <!-- 알림벨 버튼 -->
                        <button id="notif-icon" type="button" class="cursor-pointer select-none w-[80px] h-[80px]">
                            <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24">
                                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
                                   stroke-width="2">
                                    <path stroke-dasharray="4" stroke-dashoffset="4" d="M12 3v2">
                                        <animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s"
                                                 values="4;0"/>
                                    </path>
                                    <path fill="currentColor" fill-opacity="0" stroke-dasharray="28" stroke-dashoffset="28"
                                          d="M12 5c-3.31 0 -6 2.69 -6 6l0 6c-1 0 -2 1 -2 2h8M12 5c3.31 0 6 2.69 6 6l0 6c1 0 2 1 2 2h-8">
                                        <animate fill="freeze" attributeName="fill-opacity" begin="0.9s" dur="0.5s"
                                                 values="0;1"/>
                                        <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.2s" dur="0.4s"
                                                 values="28;0"/>
                                    </path>
                                    <path stroke-dasharray="8" stroke-dashoffset="8"
                                          d="M10 20c0 1.1 0.9 2 2 2c1.1 0 2 -0.9 2 -2">
                                        <animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s"
                                                 values="8;0"/>
                                    </path>
                                </g>
                            </svg>
                        </button>

                        <!-- 팝업 알림함 불러오기 -->
                        <div th:replace="common/subscription :: subscription"></div>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <script>
        // 알림 팝업 토글 + 외부 클릭 닫기
        const notifIcon = document.getElementById('notif-icon');
        const notifPopover = document.getElementById('notif-popover');
        const notifClose = document.getElementById('notif-close');
        const wrapper = document.getElementById('notif-wrapper');

        // 더보기 토글(팝업 내부)
        document.addEventListener('click', (e) => {
            if (e.target.closest('.more-btn')) {
                const btn = e.target.closest('.more-btn');
                const panel = btn.parentElement.querySelector('.more-panel');
                const icon = btn.querySelector('svg path');
                const hidden = panel.classList.contains('hidden');

                panel.classList.toggle('hidden');

                if (icon) icon.setAttribute('d', hidden ? 'M7 14l5-5 5 5z' : 'M7 10l5 5 5-5z');
            }
        });

        // 아이콘 클릭 → 팝업 열기/닫기
        notifIcon.addEventListener('click', (e) => {
            e.preventDefault();

            // 페이지 이동 방지
            notifPopover.classList.toggle('hidden');
        });

        // 닫기 버튼
        notifClose.addEventListener('click', () => notifPopover.classList.add('hidden'));

        // 바깥 클릭 시 닫기
        document.addEventListener('click', (e) => {
            if (!wrapper.contains(e.target)) notifPopover.classList.add('hidden');
        });
    </script>
</header>
