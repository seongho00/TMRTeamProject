<!DOCTYPE html>
<html lang="ko">
<head th:replace="common/head :: head">
    <meta charset="UTF-8">
    <title>ìƒê°€ì²­ì•½ ê³µê³ ë¬¸</title>
</head>
<body>
<header th:replace="common/mapHeader :: header"></header>
<!-- í•„í„°/ê²€ìƒ‰ ì˜ì—­ -->
<div class="pt-[120px]">
    <form action="/usr/lh/notice" method="get" class="w-full">
        <!-- í•„í„°/ê²€ìƒ‰ ì˜ì—­ -->
        <section class="relative z-20 max-w-[1200px] mx-auto px-6">
            <!-- ì¹´ë“œ ìŠ¤íƒ€ì¼ ë˜í¼ -->
            <div class="rounded-2xl border border-gray-200 bg-white shadow-sm">
                <!-- ìƒë‹¨: ì œëª©/ë¦¬ì…‹ -->
                <div class="flex items-center justify-between px-5 py-4 border-b">
                    <h2 class="text-base font-semibold text-gray-900">ìƒê°€ ê³µê³ </h2>
                </div>

                <!-- í•„í„° ë°”: ì‘ì€ í™”ë©´ì—ì„œëŠ” ì„¸ë¡œ ìŠ¤íƒ, í° í™”ë©´ì—ì„œëŠ” ê°€ë¡œ ì •ë ¬ -->
                <div class="px-5 py-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- ìœ í˜• -->
                        <label class="flex flex-col gap-2">
                            <span class="text-sm text-gray-700">ìœ í˜•</span>
                            <div class="relative">
                                <select name="type"
                                        class="w-full appearance-none rounded-lg border border-gray-300 bg-white px-3 py-2 pr-9 text-sm text-gray-900 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                                    <option>ì „ì²´</option>
                                    <option>ë¶„ì–‘ã†(êµ¬)ì„ëŒ€ìƒê°€(ì…ì°°)</option>
                                    <option>ì„ëŒ€ìƒê°€(ì…ì°°)</option>
                                    <option>ì„ëŒ€ìƒê°€(ê³µëª¨ã†ì‹¬ì‚¬)</option>
                                    <option>ì„ëŒ€ìƒê°€(ì¶”ì²¨)</option>
                                </select>
                                <!-- ì…€ë ‰íŠ¸ í™”ì‚´í‘œ -->
                                <span class="flex items-center pointer-events-none absolute inset-y-0 right-3 text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 640 640">
                                    <path d="M480 224C492.9 224 504.6 231.8 509.6 243.8C514.6 255.8 511.8 269.5 502.7 278.7L342.7 438.7C330.2 451.2 309.9 451.2 297.4 438.7L137.4 278.7C128.2 269.5 125.5 255.8 130.5 243.8C135.5 231.8 147.1 224 160 224L480 224z"/>
                                </svg>
                            </span>
                            </div>
                        </label>

                        <!-- ì§€ì—­ -->
                        <label class="flex flex-col gap-2">
                            <span class="text-sm text-gray-700">ì§€ì—­</span>
                            <div class="relative">
                                <select name="region"
                                        class="w-full appearance-none rounded-lg border border-gray-300 bg-white px-3 py-2 pr-9 text-sm text-gray-900 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                                    <option>ì „êµ­</option>
                                    <option>ì„œìš¸íŠ¹ë³„ì‹œ</option>
                                    <option>ë¶€ì‚°ê´‘ì—­ì‹œ</option>
                                    <option>ì¸ì²œê´‘ì—­ì‹œ</option>
                                    <option>ëŒ€êµ¬ê´‘ì—­ì‹œ</option>
                                    <option>ìš¸ì‚°ê´‘ì—­ì‹œ</option>
                                    <option>ëŒ€ì „ê´‘ì—­ì‹œ</option>
                                    <option>ê´‘ì£¼ê´‘ì—­ì‹œ</option>
                                    <option>ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ</option>
                                    <option>ê²½ê¸°ë„</option>
                                    <option>ê°•ì›íŠ¹ë³„ìì¹˜ë„</option>
                                    <option>ì¶©ì²­ë¶ë„</option>
                                    <option>ì¶©ì²­ë‚¨ë„</option>
                                    <option>ê²½ìƒë¶ë„</option>
                                    <option>ê²½ìƒë‚¨ë„</option>
                                    <option>ì „ë¶íŠ¹ë³„ìì¹˜ë„</option>
                                    <option>ì „ë¼ë‚¨ë„</option>
                                    <option>ì œì£¼íŠ¹ë³„ìì¹˜ë„</option>
                                </select>
                                <!-- ì…€ë ‰íŠ¸ í™”ì‚´í‘œ -->
                                <span class="flex items-center pointer-events-none absolute inset-y-0 right-3 text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 640 640">
                                    <path d="M480 224C492.9 224 504.6 231.8 509.6 243.8C514.6 255.8 511.8 269.5 502.7 278.7L342.7 438.7C330.2 451.2 309.9 451.2 297.4 438.7L137.4 278.7C128.2 269.5 125.5 255.8 130.5 243.8C135.5 231.8 147.1 224 160 224L480 224z"/>
                                </svg>
                            </span>
                            </div>
                        </label>

                        <!-- ìƒíƒœ -->
                        <label class="flex flex-col gap-2">
                            <span class="text-sm text-gray-700">ìƒíƒœ</span>
                            <div class="relative">
                                <select name="status"
                                        class="w-full appearance-none rounded-lg border border-gray-300 bg-white px-3 py-2 pr-9 text-sm text-gray-900 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20">
                                    <option>ì „ì²´</option>
                                    <option>ê³µê³ ì¤‘</option>
                                    <option>ì ‘ìˆ˜ì¤‘</option>
                                    <option>ì ‘ìˆ˜ë§ˆê°</option>
                                    <option>ìƒë‹´ìš”ì²­</option>
                                </select>
                                <!-- ì…€ë ‰íŠ¸ í™”ì‚´í‘œ -->
                                <span class="flex items-center pointer-events-none absolute inset-y-0 right-3 text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 640 640">
                                    <path d="M480 224C492.9 224 504.6 231.8 509.6 243.8C514.6 255.8 511.8 269.5 502.7 278.7L342.7 438.7C330.2 451.2 309.9 451.2 297.4 438.7L137.4 278.7C128.2 269.5 125.5 255.8 130.5 243.8C135.5 231.8 147.1 224 160 224L480 224z"/>
                                </svg>
                            </span>
                            </div>
                        </label>

                        <!-- ê²€ìƒ‰ -->
                        <label class="flex flex-col gap-2">
                            <span class="text-sm text-gray-700">ê²€ìƒ‰</span>
                            <div class="relative">
                                <input name="q" type="text"
                                       class="w-full rounded-full border border-gray-300 bg-white h-11 pl-5 pr-12 text-sm text-gray-900 placeholder-gray-400 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"
                                       placeholder="ê³µê³ ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" aria-label="ê³µê³ ëª… ê²€ìƒ‰" th:value="${param.q}">
                                <button type="submit"
                                        class="absolute right-1.5 top-1/2 -translate-y-1/2 inline-flex items-center justify-center w-8 h-8 rounded-full hover:bg-gray-100 text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"
                                        title="ê²€ìƒ‰" aria-label="ê²€ìƒ‰">
                                    <svg width="18" height="18" viewBox="0 0 22 22" fill="none"
                                         xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                        <circle cx="10" cy="10" r="8" stroke="currentColor"></circle>
                                        <path d="M16 16L21 21" stroke="currentColor" stroke-linecap="round"></path>
                                    </svg>
                                </button>
                            </div>
                        </label>
                    </div>

                    <!-- í™œì„± í•„í„° ì¹© ì˜ì—­ -->
                    <div id="active-filters" class="mt-4 flex flex-wrap items-center gap-2"></div>
                </div>

                <!-- í•˜ë‹¨: ì ìš©/ì´ˆê¸°í™” ë²„íŠ¼ ë°” (ì •ì  ëª©ì—…) -->
                <div class="flex items-center justify-end gap-2 px-5 pb-5">
                    <button type="button"
                            class="inline-flex items-center rounded-lg border px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                        ì´ˆê¸°í™”
                    </button>
                    <button type="submit"
                            class="inline-flex items-center rounded-lg bg-gray-700 px-4 py-2 text-sm text-white hover:bg-gray-600">
                        ì ìš©
                    </button>
                </div>
            </div>
        </section>
    </form>
</div>

<!-- ëª©ë¡ í…Œì´ë¸” -->
<section class="max-w-[1200px] mx-auto px-6 mt-10">
    <!-- ì¹´ë“œ ìŠ¤íƒ€ì¼ ë˜í¼ -->
    <div class="w-full overflow-hidden rounded-2xl border border-gray-200 shadow-sm">
        <!-- ê°€ë¡œ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ -->
        <div class="overflow-x-auto">
            <table class="w-full table-fixed text-sm">
                <!-- ê°€ë…ì„± ì¢‹ì€ ì»¬ëŸ¼ ë„ˆë¹„ -->
                <colgroup>
                    <col class="w-[70px]"/>
                    <col class="w-[100px]"/>
                    <col/>
                    <col class="w-[140px]"/>
                    <col class="w-[120px]"/>
                    <col class="w-[130px]"/>
                    <col class="w-[120px]"/>
                    <col class="w-[120px]"/>
                    <col class="w-[110px]"/>
                </colgroup>

                <!-- ê³ ì • í—¤ë”: ìŠ¤í¬ë¡¤ ì‹œ ìƒë‹¨ì— ê³ ì • -->
                <thead class="bg-gray-50 text-gray-700">
                <tr class="border-b">
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ë²ˆí˜¸</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ìœ í˜•</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ê³µê³ ëª…</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ì§€ì—­</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ë“±ë¡ì¼</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ì ‘ìˆ˜ ë‚ ì§œ</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ë§ˆê°ì¼</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ì ‘ìˆ˜ ìƒíƒœ</th>
                    <th class="sticky top-0 z-10 bg-gray-50 px-4 py-3 text-left font-medium">ì•Œë¦¼ì„¤ì •</th>
                </tr>
                </thead>

                <tbody class="divide-y divide-gray-100">
                <!-- ì£¼ì„: ë¦¬ìŠ¤íŠ¸ë¥¼ row ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ìˆœíšŒ -->
                <tr th:each="lhList : ${lhApplyInfoList}"
                    class="hover:bg-gray-50 transition-colors">
                    <!-- ë²ˆí˜¸: í•„ìš”í•˜ë©´ stat.count ì‚¬ìš© -->
                    <td class="px-4 py-4 text-gray-800" th:text="${lhList.getListNo()}"></td>

                    <!-- ìœ í˜•: ì¹© ìŠ¤íƒ€ì¼ -->
                    <td class="px-4 py-4">
                        <span class="inline-flex items-center px-2 py-0.5 text-xs"
                              th:text="${lhList.getPostType()}">
                        </span>
                    </td>

                    <!-- ê³µê³ ëª…: ë‘ ì¤„ ë§ì¤„ì„ -->
                    <td class="px-4 py-4">
                        <a class="block text-gray-900 hover:underline line-clamp-2"
                           th:text="${lhList.getName()}" th:href="${lhList.getDetailUrl()}">
                        </a>
                    </td>

                    <!-- ì§€ì—­ -->
                    <td class="px-4 py-4 text-gray-800 truncate" th:text="${lhList.getRegion()}"></td>

                    <!-- ë“±ë¡ì¼ -->
                    <td class="px-4 py-4 text-gray-800"
                        th:text="${lhList.getPostedDate()}">
                    </td>

                    <!-- ì ‘ìˆ˜ ë‚ ì§œ -->
                    <td class="px-4 py-4 text-gray-800"
                        th:text="${lhList.getApplyStart()}">
                    </td>

                    <!-- ë§ˆê°ì¼ -->
                    <td class="px-4 py-4 text-gray-800"
                        th:text="${lhList.getDueDate()}">
                    </td>

                    <!-- ì ‘ìˆ˜ ìƒíƒœ: ë°°ì§€ ìƒ‰ìƒ ë§¤í•‘ -->
                    <td class="px-4 py-4">
                        <span th:switch="${lhList.getStatus()}">
                            <span th:case="'ê³µê³ ì¤‘'"
                                  class="inline-flex items-center rounded-full bg-emerald-50 text-emerald-700 px-2 py-0.5 text-xs font-medium">ê³µê³ ì¤‘</span>
                            <span th:case="'ì ‘ìˆ˜ì¤‘'"
                                  class="inline-flex items-center rounded-full bg-rose-50 text-rose-700 px-2 py-0.5 text-xs font-medium">ì ‘ìˆ˜ì¤‘</span>
                            <span th:case="'ì ‘ìˆ˜ë§ˆê°'"
                                  class="inline-flex items-center rounded-full bg-gray-100 text-gray-600 px-2 py-0.5 text-xs font-medium">ì ‘ìˆ˜ë§ˆê°</span>
                            <span th:case="*"
                                  class="inline-flex items-center rounded-full bg-gray-50 text-gray-500 px-2 py-0.5 text-xs font-medium">-</span>
                        </span>
                    </td>

                    <!-- ì•Œë¦¼ì„¤ì •: í† ê¸€ ë²„íŠ¼ ì˜ˆì‹œ -->
                    <td class="px-4 py-4">
                        <button type="button"
                                th:classappend="${notifiedIds.contains(lhList.getId())} ? 'active' : ''"
                                class="notify-btn inline-flex items-center gap-1 rounded-md border px-2.5 py-1 text-xs text-gray-700 hover:border-gray-300 hover:bg-gray-50"
                                th:attr="data-id=${lhList.getId()}"
                                title="ì•Œë¦¼ ì„¤ì •">ì•Œë¦¼
                        </button>
                    </td>
                </tr>

                <!-- ë°ì´í„° ì—†ìŒ -->
                <tr th:if="${lhApplyInfoList.isEmpty()}">
                    <td colspan="9" class="px-4 py-16 text-center text-gray-500">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜: ì ‘ê·¼ì„± + í¬ì»¤ìŠ¤ ìŠ¤íƒ€ì¼ -->
    <nav class="my-6 flex items-center justify-center gap-2" aria-label="Pagination">
        <a class="px-3 py-1.5 rounded-md border text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">ì´ì „</a>
        <a class="px-3 py-1.5 rounded-md border text-sm bg-gray-900 text-white border-gray-900 cursor-default">1</a>
        <a class="px-3 py-1.5 rounded-md border text-sm text-gray-700 hover:bg-gray-50 cursor-pointer">ë‹¤ìŒ</a>
    </nav>
</section>
<input type="hidden" id="memberId" th:value="${memberId}">
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // í•„í„° ë°” ìœ í˜•, ì§€ì—­, ìƒíƒœ ë§¤í•‘
        const filters = [
            {name: "type", default: "ì „ì²´", label: "ìœ í˜•"},
            {name: "region", default: "ì „êµ­", label: "ì§€ì—­"},
            {name: "status", default: "ì „ì²´", label: "ìƒíƒœ"},
        ];

        const selects = Object.fromEntries(
            filters.map(f => [f.name, document.querySelector(`select[name='${f.name}']`)])
        );
        const filterArea = document.getElementById("active-filters");

        function renderChips() {
            filterArea.innerHTML = "";

            filters.forEach(f => {
                const sel = selects[f.name];
                if (!sel) return;

                const selectedText = sel.options[sel.selectedIndex]?.text || "";
                if (!selectedText || selectedText === f.default) return;

                // chip ìƒì„±
                const chip = document.createElement("span");
                chip.className =
                    "inline-flex items-center gap-2 rounded-full bg-gray-100 text-gray-700 px-3 py-1 text-xs";
                chip.innerHTML = `
                    <span class="font-medium">${f.label}</span>: ${selectedText}
                    <button type="button" class="text-black hover:text-blue-800" aria-label="${f.label} í•„í„° ì œê±°">Ã—</button>
                `;

                // chip X ë²„íŠ¼ í´ë¦­ ì‹œ ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
                chip.querySelector("button").addEventListener("click", () => {
                    const defaultOpt = Array.from(sel.options).find(o => o.text === f.default);
                    sel.value = defaultOpt ? defaultOpt.value : "";
                    renderChips();
                });

                filterArea.appendChild(chip);
            });
        }

        // ë³€ê²½ ì´ë²¤íŠ¸ ì—°ê²°
        Object.values(selects).forEach(sel => {
            if (!sel) return;
            sel.addEventListener("change", renderChips);
        });

        // ì´ˆê¸° ë Œë”
        renderChips();
    });

    // ì•Œë¦¼ ì„¤ì • ë²„íŠ¼
    $(document).on("click", ".notify-btn", function () {
        const $btn = $(this);
        const listId = $(this).data("id"); // ë²„íŠ¼ì— ë‹´ê¸´ ID
        let memberId = $("#memberId").val();

        if (!memberId) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
            window.location.href = "../member/joinAndLogin"; // ë¡œê·¸ì¸ URL ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”
            return; // ì•„ë˜ ì½”ë“œ ì‹¤í–‰ ì•ˆ í•¨
        }

        // í˜„ì¬ ìƒíƒœ í™•ì¸
        if ($btn.hasClass("active")) {
            // ğŸ‘‰ ì´ë¯¸ ì•Œë¦¼ ì„¤ì •ë¨ â†’ í•´ì œ ìš”ì²­
            $.ajax({
                type: "POST",
                url: "deleteSchedule",   // í•´ì œ API
                data: { scheduleId: listId, memberId: memberId },
                success: function () {
                    alert("ì•Œë¦¼ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
                    $btn.removeClass("active")
                        .text("ì•Œë¦¼")
                },
                error: function () {
                    alert("ì•Œë¦¼ í•´ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            });
        } else {
            // ğŸ‘‰ ì•„ì§ ì•Œë¦¼ ì„¤ì • ì•ˆ ë¨ â†’ ì„¤ì • ìš”ì²­
            $.ajax({
                type: "POST",
                url: "saveSchedule",   // ì„¤ì • API
                data: { scheduleId: listId, memberId: memberId },
                success: function () {
                    alert("ì•Œë¦¼ì´ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    $btn.addClass("active")
                        .text("ì•Œë¦¼ ì„¤ì • ğŸ””");
                },
                error: function () {
                    alert("ì•Œë¦¼ ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                }
            });
        }
    });

</script>

<style>
    .notify-btn.active {
        background-color: #3b82f6; /* íŒŒë‘ìƒ‰ */
        color: white;
    }
</style>
<footer th:replace="common/footer::footer"></footer>

</body>
</html>
