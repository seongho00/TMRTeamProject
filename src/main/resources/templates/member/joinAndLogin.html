<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/head::head"></head>

<script>
    // 비밀번호 눈 누르면 보이게하기
    function showPassword(el) {
        const $icon = $(el);

        // 가장 가까운 부모 중에서 label이 있는 쪽에서 input을 찾는다
        const $input = $icon.closest("div").find("label").find("input");
        const currentType = $input.attr("type");

        console.log("실행됨");
        if (currentType === "password") {
            $input.attr("type", "text");
            $(el).removeClass("fa-eye").addClass("fa-eye-slash");
        } else {
            $input.attr("type", "password");
            $(el).removeClass("fa-eye-slash").addClass("fa-eye");
        }
    }

    // 이름 input 유효성 검사
    function checkName(isSubmit = false) {
        const $input = $("#name");
        const $msg = $(".nameCheck-msg")
        const val = $input.val();
        const $line = $("#nameLine path");
        const nameRegex = /^([가-힣]{2,20}|[a-zA-Z]{2,20}(?:\s[a-zA-Z]{2,20})*)$/;
        const hasKoreanWithSpace = /[가-힣]+\s+[가-힣]+/;

        $msg.removeClass("hidden");
        $line.attr("stroke", "red");
        $line.attr("stroke-opacity", "1");
        $input.addClass("placeholder-red-500");

        if (val.length === 0) {
            $msg.html("이름을 입력해주세요.")
            if (isSubmit) alert("이름을 입력해주세요.");
            return false;

        } else if (hasKoreanWithSpace.test(val)) {
            $msg.html("한글 이름에는 공백을 포함할 수 없습니다.");
            if (isSubmit) alert("한글 이름에는 공백을 포함할 수 없습니다.");
            return false;
        } else if (!nameRegex.test(val)) {
            $msg.html("이름 형식에 맞게 입력해주세요.");
            if (isSubmit) alert("이름 형식에 맞게 입력해주세요.");
            return false;
        } else {
            $line.attr("stroke", "#1A1717");
            $line.attr("stroke-opacity", "0.38");
            $input.removeClass("placeholder-red-500");
            $msg.addClass("hidden");
            return true;
        }
    }

    // 이메일 input 유효성 검사
    function checkEmail(isSubmit = false) {
        const $input = $("#email");
        const $msg = $(".emailCheck-msg")
        const val = $input.val();
        const $line = $("#emailLine path");
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

        $msg.removeClass("hidden");
        $line.attr("stroke", "red");
        $line.attr("stroke-opacity", "1");
        $input.addClass("placeholder-red-500");
        if (val.length === 0) {
            $msg.html("이메일을 입력해주세요.")
            if (isSubmit) alert("이메일을 입력해주세요.");
            return false;
        } else if (!emailRegex.test(val)) {
            $msg.html("이메일 형식에 맞게 입력해주세요.")
            if (isSubmit) alert("이메일 형식에 맞게 입력해주세요.");
            return false;
        } else {
            $line.attr("stroke", "#1A1717");
            $line.attr("stroke-opacity", "0.38");
            $input.removeClass("placeholder-red-500");
            $msg.addClass("hidden");
            return true;
        }
    }

    // 비밀번호 input 유효성 검사
    function checkPassword(isSubmit = false) {
        const $input = $("#joinPw")
        const $msg = $(".passwordCheck-msg")
        const val = $input.val();
        const $line = $("#passwordLine path");
        const pwRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+=\-{}[\]:;"'<>,.?/~`])[A-Za-z\d!@#$%^&*()_+=\-{}[\]:;"'<>,.?/~`]{8,20}$/;

        $msg.removeClass("hidden");
        $line.attr("stroke", "red");
        $line.attr("stroke-opacity", "1");
        $input.addClass("placeholder-red-500");
        if (val.length === 0) {
            $msg.html("비밀번호를 입력해주세요.")
            if (isSubmit) alert("비밀번호를 입력해주세요.");
            return false;
        } else if (!pwRegex.test(val)) {
            $msg.html("비밀번호는 영문, 숫자, 특수문자를 포함해 8~20자로 입력해주세요.");
            if (isSubmit) alert("비밀번호는 영문, 숫자, 특수문자를 포함해 8~20자로 입력해주세요.");
            return false;
        } else {
            $line.attr("stroke", "#1A1717");
            $line.attr("stroke-opacity", "0.38");
            $input.removeClass("placeholder-red-500");
            $msg.addClass("hidden");
            return true;
        }
    }

    // 전화번호 input 유효성 검사
    function checkPhoneNum(isSubmit = false) {
        const $input = $("#phoneNum")
        const $msg = $(".phoneNumCheck-msg")
        const val = $input.val();
        const $line = $("#phoneNumLine path");

        $msg.removeClass("hidden");
        $line.attr("stroke", "red");
        $line.attr("stroke-opacity", "1");
        $input.addClass("placeholder-red-500");
        if (val.length === 0) {
            $msg.html("전화번호를 입력해주세요.")
            if (isSubmit) alert("전화번호를 입력해주세요.");
            return false;
        } else if (val.length < 13) {
            $msg.html("전화번호를 정확히 입력해주세요.")
            if (isSubmit) alert("전화번호를 정확히 입력해주세요.");
            return false;
        } else {
            $line.attr("stroke", "#1A1717");
            $line.attr("stroke-opacity", "0.38");
            $input.removeClass("placeholder-red-500");
            $msg.addClass("hidden");
            return true;
        }
    }


    $(document).ready(function () {

        // input 칸에서 마우스 뗐을 때
        $("#name").on("blur", function () {
            checkName(false);
        });
        $("#email").on("blur", function () {
            checkEmail(false);
        });
        $("#joinPw").on("blur", function () {
            checkPassword(false);
        });


        // 번호 input 관련 코드
        $("#phoneNum")
            // "-" 추가해주기
            .on("input", function () {
                let num = $(this).val().replace(/[^0-9]/g, "");
                if (num.length < 4) {
                    $(this).val(num);
                } else if (num.length < 8) {
                    $(this).val(num.slice(0, 3) + "-" + num.slice(3));
                } else {
                    $(this).val(num.slice(0, 3) + "-" + num.slice(3, 7) + "-" + num.slice(7, 11));
                }
            })
            // 아무것도 입력 안 했을 때 경고해주기
            .on("blur", function () {
                checkPhoneNum(false);
            });


    });

    // join submit 눌렀을 떄
    function handleSubmit(e) {
        e.preventDefault(); // 전송 막기

        const isValid =
            checkName(true) &&
            checkEmail(true) &&
            checkPassword(true) &&
            checkPhoneNum(true);

        if (isValid) {
            $("#createAccountForm").submit(); // ✅ 수동 제출
        }
    }

    // login submit 눌렀을 떄
    function handleLoginSubmit(e) {
        e.preventDefault(); // 전송 막기

        const email = $('#loginEmail').val();
        const loginPw = $('#loginPw').val();

        // 유효성 검사 등 가능
        if (!email) {
            alert("이메일을 입력하세요.");
            return;
        }

        if (!loginPw) {
            alert("비밀번호를 입력해주세요");
            return;
        }

        $("#loginForm").submit(); // ✅ 수동 제출
    }

    function toggleDiv() {
        const $joinDiv = $('.joinDiv');
        const $loginDiv = $('.loginDiv');

        // 대상이 나타날 때만 애니메이션 클래스 부여
        if ($joinDiv.hasClass('hidden')) {
            $joinDiv.removeClass('hidden').addClass('animate-popup');
            $loginDiv.addClass('hidden').removeClass('animate-popup');
        } else {
            $loginDiv.removeClass('hidden').addClass('animate-popup');
            $joinDiv.addClass('hidden').removeClass('animate-popup');
        }

        // 애니메이션 클래스 제거해서 반복 사용 가능하게
        setTimeout(() => {
            $joinDiv.removeClass('animate-popup');
            $loginDiv.removeClass('animate-popup');
        }, 400);
    }

</script>

<style>
    /* 애니메이션 코드 추가 */
    .animate-popup {
        animation: animateLogin 0.4s ease;
    }

    @keyframes animateLogin {
        0% {
            transform: scale(1, 1);
        }
        50% {
            transform: scale(1.1, 1.1);
        }
        100% {
            transform: scale(1, 1);
        }
    }
</style>

<div class="flex flex-col justify-center items-center w-screen h-screen overflow-hidden gap-2.5 px-[75px] py-[50px] bg-white">
    <div class="flex justify-start items-start flex-grow-0 flex-shrink-0 w-[1326px] h-[884px] relative"
         style="filter: drop-shadow(4px 4px 4px rgba(0,0,0,0.25));">
        <img src="/images/로그인 배경사진.png" class="flex-grow-0 flex-shrink-0 w-[1326px] h-[883px] object-cover"/>
        <div class="hidden joinDiv flex flex-col justify-center items-center flex-grow-0 flex-shrink-0 h-[883px] w-[607px] absolute left-[719px] top-0 overflow-hidden gap-[30px] py-[11px] rounded-tl-3xl rounded-bl-3xl bg-white"
             style="box-shadow: 4px 4px 4px 0 rgba(0,0,0,0.25);">
            <div class="flex justify-between items-center self-stretch flex-grow-0 flex-shrink-0 h-[34px] relative p-2.5">
                <a href="../home/main" class="cursor-pointer">
                    <img src="/images/로고.png" class="flex-grow-0 flex-shrink-0 w-[140px] h-[55px] object-cover"/>
                </a>
                <div class="flex justify-start items-center flex-grow-0 flex-shrink-0 relative overflow-hidden py-6">

                    <p class="flex-grow-0 flex-shrink-0 text-base text-left text-[#1a1717]/[0.53]">
                        English (UK)
                    </p>
                    <svg
                            width="17"
                            height="18"
                            viewBox="0 0 17 18"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            class="flex-grow-0 flex-shrink-0 w-4 h-4 relative"
                            preserveAspectRatio="none"
                    >
                        <g clip-path="url(#clip0_34_35)">
                            <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M9.50432 15.4628C9.39968 15.6319 9.25228 15.7704 9.07701 15.8643C8.90174 15.9581 8.7048 16.0041 8.50608 15.9975C8.30736 15.9909 8.11389 15.932 7.94521 15.8268C7.77654 15.7215 7.63862 15.5736 7.54539 15.398L1.0783 3.51042C0.647305 2.71772 1.22874 1.74743 2.11625 1.77682L15.8237 2.23076C16.7122 2.26018 17.2272 3.26778 16.7447 4.02922L9.50432 15.4628Z"
                                    fill="#1A1717"
                                    fill-opacity="0.38"
                            ></path>
                        </g>
                        <defs>
                            <clipPath id="clip0_34_35">
                                <rect
                                        width="16"
                                        height="16"
                                        fill="white"
                                        transform="translate(16.4705 17.2604) rotate(-178.103)"
                                ></rect>
                            </clipPath>
                        </defs>
                    </svg>
                </div>
            </div>
            <div class="flex justify-start items-start self-stretch flex-grow-0 flex-shrink-0 relative gap-2.5 pl-[25px] pr-2.5 py-2.5">
                <p class="flex-grow w-[572px] text-2xl font-bold text-left text-[#181818]">
                    Create Account
                </p>
            </div>
            <div class="flex justify-center items-center h-[90px] gap-[10px]">
                <!-- 카카오 -->
                <a href="../member/loginKakao" class="flex-1 flex justify-center">
                    <img src="/images/카카오로그인.png"
                         class="h-[40px] w-auto object-contain cursor-pointer" />
                </a>

                <!-- 네이버 -->
                <a href="../member/loginNaver" class="flex-1 flex justify-center">
                    <img src="/images/네이버로그인.png"
                         class="h-[40px] w-auto object-contain cursor-pointer" />
                </a>

                <!-- 구글 -->
                <div class="flex-1 flex justify-center">
                    <button onclick="googleLogin()"
                            class="flex items-center justify-center w-[183px] h-[40px] px-4 rounded border border-[#747775] bg-white shadow-sm cursor-pointer">
                        <!-- 아이콘 -->
                        <div class="w-4 h-4 mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" class="w-full h-full">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                                <path fill="none" d="M0 0h48v48H0z"></path>
                            </svg>
                        </div>
                        <!-- 텍스트 -->
                        <span class="flex-grow text-[14px] leading-[20px] font-['Roboto',_arial,_sans-serif] align-top text-[#1f1f1f]">Sign in with Google</span>
                    </button>
                </div>
            </div>
            <div class="flex justify-start items-start flex-grow-0 flex-shrink-0 w-[91px] relative gap-2.5 p-2.5 bg-white">
                <p class="flex-grow w-[71px] text-2xl font-bold text-left text-[#1a1717]/[0.38]">-OR-</p>
            </div>

            <form action="createAccount" method="post" id="createAccountForm">
                <div class="flex flex-col justify-start items-end flex-grow-0 flex-shrink-0 w-[546px] overflow-hidden gap-[40px] px-[22px] py-[13px]">

                    <div class=" flex flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 h-12 relative">
                        <label>
                            <input type="text" placeholder="Full Name" autocomplete="off" name="name" id="name"
                                   class="self-stretch flex-grow-0 flex-shrink-0 w-[502px] text-left text-2xl outline-none focus:outline-none focus:border-none"/>

                            <svg
                                    id="nameLine"
                                    width="503"
                                    height="2"
                                    viewBox="0 0 503 2"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="flex-grow-0 flex-shrink-0"
                                    preserveAspectRatio="none"
                            >

                                <path d="M0.5 1H502.5" stroke="#1A1717" stroke-opacity="0.38"></path>
                            </svg>
                        </label>

                        <div class="nameCheck-msg text-red-500 mt-2 flex hidden w-[502px]"></div>

                    </div>
                    <div class=" flex flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 h-12 relative">
                        <label>
                            <input type="text" placeholder="Email Address" autocomplete="off" name="email" id="email"
                                   class="self-stretch flex-grow-0 flex-shrink-0 w-[502px] text-xl text-left text-2xl outline-none focus:outline-none focus:border-none"/>

                            <svg
                                    id="emailLine"
                                    width="503"
                                    height="2"
                                    viewBox="0 0 503 2"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="flex-grow-0 flex-shrink-0"
                                    preserveAspectRatio="none"
                            >
                                <path d="M0.5 1H502.5" stroke="#1A1717" stroke-opacity="0.38"></path>
                            </svg>

                        </label>
                        <div class="emailCheck-msg text-red-500 mt-2 flex hidden w-[502px]"></div>
                    </div>
                    <div class=" flex flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 h-12 relative">
                        <label>
                            <input type="password" placeholder="Password" name="loginPw" id="joinPw" autocomplete="off"
                                   class="self-stretch flex-grow-0 flex-shrink-0 w-[502px] text-xl text-left text-2xl outline-none focus:outline-none focus:border-none"/>

                            <svg
                                    id="passwordLine"
                                    width="503"
                                    height="2"
                                    viewBox="0 0 503 2"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="flex-grow-0 flex-shrink-0"
                                    preserveAspectRatio="none"
                            >
                                <path d="M0.5 1H502.5" stroke="#1A1717" stroke-opacity="0.38"></path>
                            </svg>

                        </label>
                        <div class="passwordCheck-msg text-red-500 mt-2 flex hidden w-[502px]"></div>
                        <i onClick="showPassword(this);"
                           class="fa-solid fa-eye absolute top-0 right-0 text-2xl cursor-pointer"></i>
                    </div>

                    <div class="flex flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 h-12 relative">
                        <label>
                            <input type="text" placeholder="PhoneNumber" name="phoneNum" autocomplete="off"
                                   maxlength="13"
                                   id="phoneNum"
                                   class="self-stretch flex-grow-0 flex-shrink-0 w-[502px] text-xl text-left text-2xl outline-none focus:outline-none focus:border-none"
                            />

                            <svg
                                    id="phoneNumLine"
                                    width="503"
                                    height="2"
                                    viewBox="0 0 503 2"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="flex-grow-0 flex-shrink-0"
                                    preserveAspectRatio="none"
                            >
                                <path d="M0.5 1H502.5" stroke="#1A1717" stroke-opacity="0.38"></path>
                            </svg>

                        </label>

                        <div class="phoneNumCheck-msg text-red-500 mt-2 flex hidden w-[502px]"></div>
                    </div>

                </div>
            </form>
            <button form="createAccountForm" onClick="handleSubmit(event);"
                    class="flex justify-start items-start flex-grow-0 flex-shrink-0 w-[502px] h-12 relative gap-2.5 p-2.5 rounded-lg bg-[#279574] cursor-pointer">
                <p class="flex-grow w-[482px] text-xl font-semibold text-center text-white ">
                    Create Account
                </p>
            </button>

            <div onClick="toggleDiv();"
                 class="flex justify-center items-center flex-grow-0 flex-shrink-0 w-[350px] h-11 relative gap-2.5 p-2.5 cursor-pointer">
                <p class="flex-grow w-[310px] text-xl font-medium text-center">
                    <span class="flex-grow w-[310px] text-xl font-medium text-center text-black/30">Already have an account ?</span>
                    <span class="flex-grow w-[310px] text-xl font-medium text-center text-black/[0.12]"></span>
                    <span class="flex-grow w-[310px] text-xl font-medium text-center text-[#54beb8]">Sign Up</span>
                </p>
            </div>
        </div>

        <div class="loginDiv flex flex-col justify-center items-center w-[607px] absolute translate-y-[95px] left-[719px] gap-[30px] py-[11px] top-2.5 rounded-tl-3xl rounded-bl-3xl bg-white"
             style="box-shadow: 4px 4px 4px 0 rgba(0,0,0,0.25);">
            <div class="flex justify-between items-center self-stretch flex-grow-0 flex-shrink-0 h-[34px] relative p-2.5">
                <a href="../home/main" class="cursor-pointer">
                    <img src="/images/로고.png"
                         class="flex-grow-0 flex-shrink-0 w-[140px] h-[55px] object-cover"/>
                </a>
                <div class="flex justify-start items-center flex-grow-0 flex-shrink-0 relative overflow-hidden py-6">
                    <p class="flex-grow-0 flex-shrink-0 text-base text-left text-[#1a1717]/[0.53]">
                        English (UK)
                    </p>
                    <svg
                            width="17"
                            height="18"
                            viewBox="0 0 17 18"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                            class="flex-grow-0 flex-shrink-0 w-4 h-4 relative"
                            preserveAspectRatio="none"
                    >
                        <g clip-path="url(#clip0_34_35)">
                            <path
                                    fill-rule="evenodd"
                                    clip-rule="evenodd"
                                    d="M9.50432 15.4628C9.39968 15.6319 9.25228 15.7704 9.07701 15.8643C8.90174 15.9581 8.7048 16.0041 8.50608 15.9975C8.30736 15.9909 8.11389 15.932 7.94521 15.8268C7.77654 15.7215 7.63862 15.5736 7.54539 15.398L1.0783 3.51042C0.647305 2.71772 1.22874 1.74743 2.11625 1.77682L15.8237 2.23076C16.7122 2.26018 17.2272 3.26778 16.7447 4.02922L9.50432 15.4628Z"
                                    fill="#1A1717"
                                    fill-opacity="0.38"
                            ></path>
                        </g>
                        <defs>
                            <clipPath id="clip0_34_35">
                                <rect
                                        width="16"
                                        height="16"
                                        fill="white"
                                        transform="translate(16.4705 17.2604) rotate(-178.103)"
                                ></rect>
                            </clipPath>
                        </defs>
                    </svg>
                </div>
            </div>
            <div class="flex justify-start items-start self-stretch flex-grow-0 flex-shrink-0 relative gap-2.5 pl-[25px] pr-2.5 py-2.5">
                <p class="flex-grow w-[572px] text-2xl font-bold text-left text-[#181818]">
                    Sign Up
                </p>
            </div>
            <div class="flex justify-center items-center h-[90px] gap-[10px]">
                <!-- 카카오 -->
                <a href="../member/loginKakao" class="flex-1 flex justify-center">
                    <img src="/images/카카오로그인.png"
                         class="h-[40px] w-auto object-contain cursor-pointer" />
                </a>

                <!-- 네이버 -->
                <a href="../member/loginNaver" class="flex-1 flex justify-center">
                    <img src="/images/네이버로그인.png"
                         class="h-[40px] w-auto object-contain cursor-pointer" />
                </a>

                <!-- 구글 -->
                <div class="flex-1 flex justify-center">
                    <button onclick="googleLogin()"
                            class="flex items-center justify-center w-[183px] h-[40px] px-4 rounded border border-[#747775] bg-white shadow-sm cursor-pointer">
                        <!-- 아이콘 -->
                        <div class="w-4 h-4 mr-2">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" class="w-full h-full">
                                <path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                                <path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"></path>
                                <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                                <path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                                <path fill="none" d="M0 0h48v48H0z"></path>
                            </svg>
                        </div>
                        <!-- 텍스트 -->
                        <span class="flex-grow text-[14px] leading-[20px] font-['Roboto',_arial,_sans-serif] align-top text-[#1f1f1f]">Sign in with Google</span>
                    </button>
                </div>
            </div>
            <div class="flex justify-start items-start flex-grow-0 flex-shrink-0 w-[91px] relative gap-2.5 p-2.5 bg-white">
                <p class="flex-grow w-[71px] text-2xl font-bold text-left text-[#1a1717]/[0.38]">-OR-</p>
            </div>
            <form action="doLogin" method="post" id="loginForm">
                <div class="flex flex-col justify-start items-end flex-grow-0 flex-shrink-0 w-[546px] overflow-hidden gap-[40px] px-[22px] py-[13px]">

                    <div class=" flex flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 h-12 relative">
                        <label>
                            <input type="text" placeholder="Email Address" autocomplete="off" name="username"
                                   id="loginEmail"
                                   class="self-stretch flex-grow-0 flex-shrink-0 w-[502px] text-xl text-left text-2xl outline-none focus:outline-none focus:border-none"/>

                            <svg
                                    id="emailLine"
                                    width="503"
                                    height="2"
                                    viewBox="0 0 503 2"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="flex-grow-0 flex-shrink-0"
                                    preserveAspectRatio="none"
                            >
                                <path d="M0.5 1H502.5" stroke="#1A1717" stroke-opacity="0.38"></path>
                            </svg>

                        </label>
                    </div>
                    <div class=" flex flex-col justify-start items-start self-stretch flex-grow-0 flex-shrink-0 h-12 relative">
                        <label>
                            <input type="password" placeholder="Password" name="password" id="loginPw"
                                   autocomplete="off"
                                   class="self-stretch flex-grow-0 flex-shrink-0 w-[502px] text-xl text-left text-2xl outline-none focus:outline-none focus:border-none"/>

                            <svg
                                    id="passwordLine"
                                    width="503"
                                    height="2"
                                    viewBox="0 0 503 2"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                    class="flex-grow-0 flex-shrink-0"
                                    preserveAspectRatio="none"
                            >
                                <path d="M0.5 1H502.5" stroke="#1A1717" stroke-opacity="0.38"></path>
                            </svg>

                        </label>
                        <i onClick="showPassword(this);" class="fa-solid fa-eye absolute top-0 right-0 text-2xl cursor-pointer"></i>
                    </div>
                </div>
            </form>

            <button form="loginForm" onClick="handleLoginSubmit(event);"
                    class="flex justify-start items-start flex-grow-0 flex-shrink-0 w-[502px] h-12 relative gap-2.5 p-2.5 rounded-lg bg-[#279574] cursor-pointer">
                <p class="flex-grow w-[482px] text-xl font-semibold text-center text-white ">
                    Sign Up
                </p>
            </button>

            <div onClick="toggleDiv();"
                 class="flex justify-center items-center flex-grow-0 flex-shrink-0  w-[400px] h-11 relative gap-2.5 p-2.5 cursor-pointer">
                <p class="flex-grow w-[310px] text-xl font-medium text-center">
                    <span class="flex-grow w-[310px] text-xl font-medium text-center text-black/30">Don't Have an Account?</span>
                    <span class="flex-grow w-[310px] text-xl font-medium text-center text-black/[0.12]"></span>
                    <span class="flex-grow w-[310px] text-xl font-medium text-center text-[#54beb8]">Create Account</span>
                </p>
            </div>
        </div>
    </div>
</div>

<!-- 구글 로그인 -->
<script type="module">
    import {initializeApp} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
        getAuth,
        GoogleAuthProvider,
        signInWithPopup
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    // ✅ Firebase 설정
    const firebaseConfig = {
        apiKey: "AIzaSyDqY-Lj2sJliSi2FOF-nwXf5d99lrlWyMs",
        authDomain: "tmrteamproject.firebaseapp.com",
        projectId: "tmrteamproject",
        storageBucket: "tmrteamproject.firebasestorage.app",
        messagingSenderId: "1042006957683",
        appId: "1:1042006957683:web:7aa5565d3dacc30fda5406",
        measurementId: "G-RE253T3ZQY"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);


    // ✅ 구글 로그인 함수
    // ✅ Google 로그인 함수
    window.googleLogin = async () => {
        const provider = new GoogleAuthProvider();

        // 🔒 기본 및 민감한 정보 scope 추가
        provider.addScope('profile');
        provider.addScope('email');
        provider.addScope('https://www.googleapis.com/auth/user.phonenumbers.read');

        provider.setCustomParameters({prompt: 'select_account'});

        try {
            const result = await signInWithPopup(auth, provider);

            const user = result.user;
            console.log("✅ 로그인 성공:", user);

            // ✅ Firebase idToken → 서버 전송 (선택)
            const idToken = await user.getIdToken();

            const token = await user.getIdTokenResult();
            console.log(token.claims);
            console.log(token.signInProvider);
            // ✅ accessToken → Google People API 호출
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const accessToken = credential.accessToken;

            const profile = await fetchGoogleProfileData(accessToken);

            if (profile) {
                console.log("🙋 유저 이름:", profile.name);
                console.log("📧 이메일:", profile.email);
                console.log("📞 전화번호:", profile.phone);
                console.log("🖼️ 프로필 이미지:", profile.photoUrl);
                sendTokenToServer(idToken, profile);
            }
        } catch (error) {
            console.error("❌ 로그인 실패:", error);
        }
    };

    async function fetchGoogleProfileData(accessToken) {
        try {
            const response = await fetch(
                "https://people.googleapis.com/v1/people/me?personFields=names,emailAddresses,birthdays,phoneNumbers,photos",
                {
                    headers: {
                        Authorization: `Bearer ${accessToken}`
                    }
                }
            );

            if (!response.ok) {
                throw new Error("Google API 호출 실패: " + response.statusText);
            }

            const data = await response.json();
            console.log("✅ People API 응답:", data);

            // ✅ 원하는 정보 파싱
            const name = data.names?.[0]?.displayName || "이름 없음";
            const email = data.emailAddresses?.[0]?.value || "이메일 없음";
            const birthday = data.birthdays?.[0]?.date || null;
            const phone = data.phoneNumbers?.[0]?.value || "전화번호 없음";
            const photoUrl = data.photos?.[0]?.url || null;

            return {
                name,
                email,
                birthday,
                phone,
                photoUrl
            };
        } catch (err) {
            console.error("❌ Google People API 오류:", err);
            return null;
        }
    }


    // ✅ 서버로 토큰 전송
    function sendTokenToServer(idToken, profile) {
        fetch("http://localhost:8080/usr/member/googleCallback", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                idToken,
                name: profile.name,
                email: profile.email,
                phone: profile.phone,
                photoUrl: profile.photoUrl
            })  // ✅ 여기에 idToken 추가
        })
            .then(res => {
                if (!res.ok) throw new Error("서버 응답 실패");
                return res.text();
            })
            .then(result => {
                console.log("✅ 서버 응답:", result);
                // ✅ 리디렉션 실행
                window.location.href = "/usr/home/main";  // 원하는 경로로 수정
            })
            .catch(err => {
                console.error("❌ 서버 요청 실패:", err);
                alert("로그인 처리 중 오류가 발생했습니다.");
            });
    }


    window.deleteAccount = () => {
        const user = auth.currentUser;

        if (user) {
            const confirmDelete = confirm("정말로 계정을 삭제하시겠습니까?\n복구가 불가능합니다.");
            if (!confirmDelete) return;

            user.delete()
                .then(() => {
                    alert("✅ 계정이 성공적으로 삭제되었습니다.");
                    console.log("✅ Firebase 사용자 삭제 완료");
                })
                .catch((error) => {
                    console.error("❌ 계정 삭제 실패:", error);

                    // 🔑 예외: 최근 로그인 필요
                    if (error.code === 'auth/requires-recent-login') {
                        alert("🔐 보안을 위해 최근 로그인 후 다시 시도해주세요.");
                    } else {
                        alert("계정 삭제 중 오류가 발생했습니다.");
                    }
                });
        } else {
            alert("❌ 현재 로그인된 사용자가 없습니다.");
        }
    };

</script>
