<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/head::head">
    <meta charset="UTF-8">
    <title>지도기반 유동인구와 매출액 분석</title>
</head>
<body>
<header th:replace="common/mapHeader::header"></header>

<!-- 카카오맵 SDK: autoload=false 이므로 kakao.maps.load(...) 필수 -->
<script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=69544617df3febfc879cd18eed451ba3&libraries=services&autoload=false"></script>

<style>
    /* Chrome, Edge, Safari */
    .report::-webkit-scrollbar {
        width: 10px; /* 세로 스크롤바 두께 */
        height: 10px; /* 가로 스크롤바 두께 */
    }

    .report::-webkit-scrollbar-track {
        background: #f1f1f1; /* 트랙(배경) 색상 */
        border-radius: 8px;
    }

    .report::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, #2563eb, #1e40af); /* 파랑 그라데이션 */
        border-radius: 8px;
    }

    .report::-webkit-scrollbar-thumb:hover {
        background: #1d4ed8; /* hover 시 진한 파랑 */
    }

    /* Firefox */
    .report {
        scrollbar-width: thin; /* auto, thin */
        scrollbar-color: #2563eb #f1f1f1; /* thumb 색상 / 트랙 색상 */
    }
</style>
<!-- 지도 영역 -->
<div id="map" class="w-full h-screen"></div>


<!-- 좌측 패널 -->
<aside class="absolute top-[160px] left-[40px] z-20 w-[420px] bg-white/90 backdrop-blur rounded-2xl border border-gray-200 shadow-2xl overflow-hidden">

    <!-- 패널 헤더 : 제목 + 메트릭 탭 -->
    <header class="sticky top-0 bg-gradient-to-r from-indigo-600 to-indigo-500 text-white px-6 py-5">
        <!-- 제목 -->
        <h2 class="text-xl font-extrabold tracking-tight">행정동 분석 정보</h2>
        <!-- 부제(선택된 행정동 라벨) -->
        <p id="emdName" class="mt-1 text-sm/6 text-indigo-100">행정동을 선택해 주세요</p>
    </header>

    <!-- 본문 컨테이너 -->
    <div class="p-6 space-y-6">

        <!-- 영역 선택 섹션 : 셀렉트 3종 -->
        <section class="rounded-xl border border-gray-100 bg-white shadow-sm p-4">
            <!-- 섹션 제목 -->
            <div class="flex items-center justify-between mb-3">
                <h3 class="text-sm font-semibold text-gray-800">지역 선택</h3>
                <!-- 기준일 표시 영역(옵션) -->
                <span id="panel-updated-at" class="text-xs text-gray-500"></span>
            </div>

            <!-- 3분할 그리드 -->
            <div class="grid grid-cols-1 gap-2">
                <!-- 시/도 -->
                <label class="flex items-center gap-2">
                    <span class="w-16 shrink-0 text-xs text-gray-500">시/도</span>
                    <select id="sidoSelect"
                            class="w-full rounded-lg border-gray-300 text-sm px-3 py-2
                         focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option>서울특별시</option>
                    </select>
                </label>

                <!-- 시/군/구 -->
                <label class="flex items-center gap-2">
                    <span class="w-16 shrink-0 text-xs text-gray-500">시/군/구</span>
                    <select id="sggSelect"
                            class="w-full rounded-lg border-gray-300 text-sm px-3 py-2
                         focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">선택</option>
                        <!-- 서버 렌더링 영역 -->
                        <th:block th:each="adminDong : ${adminDongsGroupBySggCd}">
                            <option th:value="${adminDong.sggNm}" th:text="${adminDong.sggNm}"></option>
                        </th:block>
                    </select>
                </label>

                <!-- 행정동 -->
                <label class="flex items-center gap-2">
                    <span class="w-16 shrink-0 text-xs text-gray-500">행정동</span>
                    <select id="emdSelect"
                            class="w-full rounded-lg border-gray-300 text-sm px-3 py-2
                         focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="">선택</option>
                    </select>
                </label>
            </div>
        </section>

        <!-- 메트릭 카드 : 유동인구 -->
        <section id="card-floating"
                 class="rounded-xl border border-gray-100 bg-gradient-to-b from-white to-indigo-50/60
                    shadow-sm p-4">
            <!-- 카드 헤더 -->
            <div class="flex items-center justify-between">
                <h3 class="text-sm font-semibold text-gray-800">유동인구</h3>
                <!-- 그래프 보기(옵션) -->
                <button id="show-fp-graph"
                        class="px-2 py-0.5 rounded-full text-[11px] font-medium bg-indigo-100 text-indigo-700 cursor-pointer"
                        onclick="openReport();">
                    그래프 보기
                </button>
            </div>

            <!-- 핵심 숫자 -->
            <p id="floatingPopulation"
               class="mt-2 text-3xl font-extrabold tracking-tight text-gray-900">-</p>

            <!-- 보조 라벨 -->
            <p class="mt-1 text-xs text-gray-500">단위: 만명</p>

            <!-- 미세 지표 2열 (옵션) -->
            <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
                <div class="rounded-lg bg-white border border-gray-100 p-3">
                    <p class="text-gray-500 text-xs">당월 매출 추정</p>
                    <p id="sales-per-capita-fp" class="font-semibold text-gray-800">-</p>
                    <!-- 보조 라벨 -->
                    <p class="mt-1 text-[8px] text-gray-500">단위: 억원</p>
                </div>
                <div class="rounded-lg bg-white border border-gray-100 p-3">
                    <p class="text-gray-500 text-xs">최근 분기</p>
                    <p id="recent-period-fp" class="font-semibold text-gray-800">-</p>
                </div>
            </div>
        </section>

        <!-- 도움말 -->
        <p class="text-[12px] text-gray-500">
            지도에서 행정동을 클릭하거나 상단의 지역 선택을 변경하면 카드가 갱신됩니다.
        </p>
    </div>


</aside>

<!-- 팝업창 -->
<div class="report fixed top-[120px] left-[470px] w-[500px] h-[800px] z-10
            bg-white/90 backdrop-blur rounded-2xl border border-gray-200 shadow-2xl rounded-lg
            transform transition-all duration-300 ease-in-out opacity-0 -translate-x-4 overflow-auto hidden">
    <h2 class="flex justify-center h-[70px] text-lg font-bold p-4">
        유동인구 분석 그래프
    </h2>

    <!-- 성별 데이터 -->
    <div class="flex justify-between p-2">
        <span class="font-bold text-lg"><i class="fa-solid fa-venus-mars"></i>성별 유동인구</span>
        <span class="text-sm text-gray-600"> 25년 1분기 기준</span>
    </div>
    <div class="flex items-start m-3">
        <canvas id="genderFloatingChart" class="my-3 border border-gray-300 rounded-lg shadow-lg" width="250"
                height="250"></canvas>
        <div class="flex items-center h-[250px]">
            <div id="genderPopulationAnalysis"
                 class="flex flex-col relative py-5 px-2 border-2 rounded-lg m-3 text-sm text-gray-700 border border-red-500 w-[200px]"
            >
            </div>
        </div>
    </div>

    <div class="flex justify-between p-2">
        <span class="font-bold text-lg">
            <i class="fa-solid fa-clock"></i>
            시간대, 요일별 유동인구</span>
        <span class="text-sm text-gray-600"> 25년 1분기 기준</span>
    </div>

    <canvas id="timeSalesChart" class="m-3 border border-gray-300 rounded-lg shadow-lg" width="600"
            height="300"></canvas>
    <canvas id="weeklyPopulationChart" class="m-3 mb-6 border border-gray-300 rounded-lg shadow-lg" width="600"
            height="300"></canvas>
    <div id="weeklyPopulationAnalysis"
         class="flex flex-col relative p-5 border-2 rounded-lg m-3 mt-2 text-sm text-gray-700 border border-red-500">
    </div>

    <div class="flex justify-between p-2">
        <span class="font-bold text-lg">
            <i class="fa-solid fa-users"></i>
            상주,직장,유동인구</span>
        <span class="text-sm text-gray-600"> 25년 1분기 기준</span>
    </div>

    <canvas id="populationByAgeChart" class="m-3 mb-6 border border-gray-300 rounded-lg shadow-lg" width="600"
            height="400"></canvas>
    <div id="populationAnalysis"
         class="flex flex-col relative p-5 border-2 rounded-lg m-3 mt-2 text-sm text-gray-700 border border-red-500"></div>

    <!-- 닫기 버튼 -->
    <button class="p-0 flex items-center justify-center absolute
         top-3 right-3 z-[9999]
         w-[2.75rem] h-[2.75rem]
         rounded-full border border-gray-300
         bg-white shadow-[2px_2px_8px_0_rgba(0,0,0,0.1)] cursor-pointer"
            onclick="closeReport();">
        <i class="fa-solid fa-xmark"></i>
    </button>

</div>


<!-- 지도/업종 스크립트 -->
<script type="text/javascript" th:src="@{/js/commercialZoneMap.js}"></script>

<div th:replace="chatbot/chat::chat"></div>

</body>
</html>
