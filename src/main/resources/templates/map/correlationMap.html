<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="common/head::head">
    <meta charset="UTF-8">
    <title>지도기반 유동인구에 따른 매출액과 상관관계 위험도 분석</title>
</head>
<body>
<header th:replace="common/mapHeader::header"></header>

<!-- 카카오맵 SDK: autoload=false 이므로 kakao.maps.load(...) 필수 -->
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=69544617df3febfc879cd18eed451ba3&libraries=services&autoload=false"></script>

<!-- 지도 영역 -->
<div id="map" class="w-full h-screen pt-[100px]"></div>

<!-- 좌측 선택 패널 -->
<div class="flex absolute top-[180px] left-[150px] justify-start items-start gap-2.5 px-[7px] py-1 z-10">
    <div class="flex flex-col items-center h-[615px] w-[445px] gap-[31px] pt-[30px] pb-[99px] rounded-[15px] bg-white border border-black">
        <div class="self-stretch h-[46px] px-[30px]">
            <p class="text-xl font-medium">점수 확인</p>
        </div>

        <div class="flex flex-col justify-start items-start flex-grow-0 flex-shrink-0 overflow-hidden gap-5">
            <!-- 업종 검색/선택 -->
            <div class="flex flex-col justify-center items-center flex-grow-0 flex-shrink-0 w-[407px] overflow-hidden gap-2.5 px-[104px] py-2.5">
                <div class="flex justify-between items-center w-[381px] h-[41px] relative gap-2.5 px-2.5 py-[7px] rounded-[15px] bg-white border border-black">
                    <input id="upjongSearch"
                           class="upjongInput flex-grow text-base focus:outline-none"
                           placeholder="업종을 입력해줘 (예: 한식, 커피-음료 등)"/>
                    <svg width="20" height="20" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="9" cy="9" r="8.5" transform="matrix(-1 0 0 1 18 0)" stroke="black"></circle>
                        <path d="M15 15.5L21 21.5" stroke="black" stroke-linecap="round"></path>
                    </svg>

                    <!-- 자동완성 드롭다운 -->
                    <div id="upjongSearchDrop"
                         class="absolute left-0 right-0 top-full bg-white border rounded shadow hidden max-h-60 overflow-auto z-20"></div>
                </div>
            </div>

            <!-- 그룹 탭 -->
            <div class="flex flex-col justify-center items-center w-[407px] overflow-hidden gap-[12px]">
                <!-- 업종 리스트 -->
                <div id="upjongList" class="grid grid-cols-2 gap-2 h-56 overflow-auto border rounded p-2 bg-white">
                    <!-- 비어있을 때 메시지 -->
                    <div th:if="${upjongNames.isEmpty()}" class="col-span-2 text-center text-gray-500 py-6">
                        업종 결과가 없어
                    </div>

                    <!-- 업종 버튼 렌더링 -->
                    <button
                            th:each="nm : ${upjongNames}"
                            type="button"
                            class="upjong-btn w-full text-left px-3 py-2 rounded border hover:bg-gray-50"
                            th:text="${nm}"
                            th:attr="data-nm=${nm}">
                    </button>
                </div>

                <!-- 기존 코드 호환용 hidden input -->
                <input class="upjongInput hidden">
            </div>
        </div>

        <!-- 확인 버튼 -->
        <button type="button" onclick="searchInfoByRegionAndUpjong();"
                class="px-[115px] py-2.5 rounded-[10px] bg-[#1110ff]">
            <p class="text-xl font-medium text-white">확인</p>
        </button>

        <!-- 결과 패널 -->
        <div class="px-[53px]">
            <div id="riskResult" class="hidden min-w-[205px] min-h-[120px] p-3 rounded-[6px] border border-gray-300 bg-white text-sm">
            </div>
        </div>
    </div>

    <!-- 중/소분류 팝업(필요시 사용) -->
    <div class="middleSelector hidden w-[386px] h-[200px] px-[10px] rounded-[15px] bg-white border border-black">
        <ul class="w-full overflow-auto p-2.5"></ul>
    </div>
    <div class="minorSelector hidden w-[386px] h-[200px] px-[23px] py-[13px] rounded-[15px] bg-white border border-black">
        <ul class="w-full overflow-auto p-2.5"></ul>
    </div>
</div>

<!-- 상단 중앙 지역 선택 UI -->
<ul class="flex justify-between items-center w-[450px] h-[47px] overflow-hidden px-[10px] py-[15px] rounded-[10px] bg-white border border-black absolute left-1/2 -translate-x-1/2 top-[110px] z-10">
    <li class="flex justify-center items-center h-[41px]">
        <select id="sidoSelect" name="sidoSelect"
                class="text-[18px] text-center text-black focus:outline-none">
            <option>서울특별시</option>
        </select>
    </li>

    <li class="flex justify-center items-center h-[41px]">
        <select id="sggSelect" name="sggSelect"
                class="text-[18px] text-center text-black focus:outline-none">
            <option value="">시/군/구</option>
            <th:block th:each="adminDong : ${adminDongsGroupBySggCd}">
                <option th:value="${adminDong.sggNm}" th:text="${adminDong.sggNm}"></option>
            </th:block>
        </select>
    </li>

    <li class="flex justify-center items-center h-[41px]">
        <select id="emdSelect" name="emdSelect"
                class="text-[18px] text-center text-black focus:outline-none">
            <option value="">행정동</option>
        </select>
    </li>
</ul>

<!-- 지도/업종 스크립트 -->
<script type="text/javascript" th:src="@{/js/correlationMap.js}"></script>

<!-- 챗봇 불러오기 -->
<div th:replace="chatbot/chatbot::chatbot"></div>
</body>
</html>
